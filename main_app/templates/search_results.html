<!DOCTYPE html>
<html lang="en">

<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<title>COVID Tracker</title>
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
<link rel="icon" href="https://cdn.pixabay.com/photo/2017/09/11/03/18/virus-icon-2737712_1280.png">
<!-- Latest compiled and minified JavaScript -->


<style>


body {
padding: 0;
margin: 0;
}
html, body, #mapid {
height: 25vw;
width: 100vw;
text-decoration: none!important;
}

#mapid {
z-index: 1!important;
display: block!important;
}

body:hover {
text-decoration: none!important;
}

#madeby {
margin-top: 10%;
font-size: 3vw;
margin-left: 35vw;
}

#wth {
        margin-left: 38vw;
   }

#king {
  margin-left: 42vw;
}
#iphone {
  margin-left: 25vw;
  margin-bottom: 2%;
  width: 50vw;
}

 #one {
     margin-left: 5vw;
      color: white;
   }
   #two {
        margin-left: 5vw;
   }
   #three {
       margin-left: 5vw;
   }



@media all and (max-width: 460px) {

    #covid {
        font-size: 0.9em;
    }

    #search {
        margin-left: 26vw;
}

#nahome {
    margin-left: 20vw!important;
}

#resetme {

}

#madeby {
font-size: 20px!important;
margin-top: 10%!important;
margin-left: 25vw!important
}



#mapid {
        height: 90vw!important;
    }
    #wth {
      margin-left: 32vw!important;
   }

  #king {
       margin-left: 32vw!important;
  }
  #iphone {
  }
})

@media all and (max-width: 360px) {
#mapid {
        height: 85vw!important;
   }

})



</style>

</head>

<body>
<i>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<div class='container'>
<h1><img src="https://cdn.pixabay.com/photo/2017/09/11/03/18/virus-icon-2737712_1280.png" width=55 height=50/><i id='covid'> COVID Tracker</i></h1>
<button id='wth' style='margin-bottom: 2%; outline: 0;' class='btn btn-info'>What is this?</button>



<i>
<div class="alert alert-warning" role="alert" id='graph'>
 <p>The Irish government has <a target="_blank" href="https://www.gov.ie/en/publication/cf9b0d-new-public-health-measures-effective-now-to-prevent-further-spread-o/">implemented further social restrictions</a> in an effort to combat COVID-19.
Any non-essential movement beyond your home is limited to a 5km radius only for exercising.
This map will not only show you what that radius looks like, but it also has a distance calculator that tells you if your destination is outside the safe zone.</p>
<hr>
 <p class="mb-0">

<ol>If at home, you can type your destination and see if it is in the safe zone.</ol> <br>
<ol>If you are not at home, you can type your home address to see if you are in the safe zone.</ol><br>
<ol>If the map doesn't show; enable location services on your phone and for your browser and allow the site permission to your access your location</ol><br>
<ol>If your location cant be found; please make sure spelling is correct. If location is inaccurate, please adjust the pin to suit your needs.</ol><br>
<ol>To start a traker, simply click the button. You can turn off your phone, but occasionally check the site for location update. A warning message will show up when you have passed your zone.</ol>
</p>
</i>
</div>
<br>
</div>

<div class='moveme'>

<div class=''>
<div class=''>
<div id="mapid" class=''></div>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>



</div>
</div>
<br>

<form action="{% url 'search_view' %}" class="form-wrap mt-4" method="get" autocomplete="off">
                                  {% csrf_token %}
                                    <div class="btn-group" role="group" aria-label="Basic example">
                                        <input id='q' name="q" type="text" placeholder="Name.." class="btn-group1" style="outline: 0;" hidden>
                                        <input id="area" name="area" type="text" placeholder="Area.." class="btn-group2" style="outline: 0;"  hidden>
                                        <input id="latlng1" name="latlng1" type="text" placeholder="Area.." class="btn-group2" style="outline: 0;" hidden>
                                        <input id="latlng2" name="latlng2" type="text" placeholder="Area2.." class="btn-group2" style="outline: 0;" hidden>

                                        <input id="king" name="king" type="text" placeholder="Type Destination..." class="btn-group2" style="outline: 0; margin-bottom: 2%;">
                                         <input id="iphone" name="iphone" type="text" placeholder="Move Pin or Type  Location..." class="btn-group2" style="outline: 0;">
                                         &nbsp;
                                         <br>
                                        <input class='btn btn-warning' id="resetme" type='button' style="top: 30vw; left: 26vw; outline: 0; margin-bottom: 0vw;" onlclick="resetmama();" value='Reset Current Location'>



                                        <button id='search' type="submit" class="btn btn-info" style="outline: 0; color: white; margin-left: 45vw; margin-bottom: 2%;">Calculate</button><br>
                                                                                                                 <button id="snooper"  class="btn btn-success" style="outline: 0; color: white; margin-left: 44vw; margin-bottom: 2%;" onlclick="makeTracker();">Start Tracker</button>

                                    </div>
                                </form>


                                                                        <button id="nahome" class="btn btn-warning" style="outline: 0; color: white; margin-left: 38vw;" onclick="la2();">Need a Tracker but not at Home?</button>



<br>
<div id='tom' class="" role="alert">
<p id='one' style="color:white;">{{a}}</p>

<p style="color: white;" id='rush'>{{z1}}</p>
<p style="color: white;" id='rush2'>{{z2}}</p>
<p id='two'></p>
<p id='three'></p>
<p id='four'></p>
</div>
<br>
<br>
<br>
<p id='hello' style='color: white;'>{{latl}}</p>
<p id='hello2' style="color: white;">{{latl2}}</p>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>




<p id="demo" style="color: white;"></p>
<p id="upd" style=""></p>

<script>

var x = document.getElementById("demo");
var initlat = sessionStorage.getItem('initlat');
var initlon = sessionStorage.getItem('initlon');



var userPosition =
        {
        lat: 53.159830,
        lon: -6.909000,
        mylat: 53.159830,
        mylon: -6.909000
        };


getLocation();


function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  x.innerHTML = "Latitude: " + position.coords.latitude +
  "<br>Longitude: " + position.coords.longitude;
}


function showError(error) {
  switch(error.code) {
    case error.PERMISSION_DENIED:
      x.innerHTML = "User denied the request for Geolocation."
      break;
    case error.POSITION_UNAVAILABLE:
      x.innerHTML = "Location information is unavailable."
      break;
    case error.TIMEOUT:
      x.innerHTML = "The request to get user location timed out."

      break;
    case error.UNKNOWN_ERROR:
      x.innerHTML = "An unknown error occurred."
      break;
  }
}



</script>

</body>
</html>



</div>
</i>
<script>
var y = document.getElementById("upd");

var atHome = sessionStorage.getItem('atHome') || 'no';

function la2() {
    location.reload(true);
    sessionStorage.setItem('atHome','yes');
}

function resetmama() {
    document.location.href="/";
    sessionStorage.clear()
    $('#search').text('Set as your Location')
        document.querySelector('#search').setAttribute('margin-left','32vw')


}

$('#resetme').on('click',resetmama);


$(document).ready(function(){
    $('#iphone').hide()
    $('#resetme').hide()




function iOSSafari(userAgent)
{
    return /iP(ad|od|hone)/i.test(userAgent) && /WebKit/i.test(userAgent) && !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(userAgent));
}

var iOSSafari = /iP(ad|od|hone)/i.test(window.navigator.userAgent) && /WebKit/i.test(window.navigator.userAgent) && !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(window.navigator.userAgent));

$('#graph').hide()
$("#wth").click(function(){
$("#graph").toggle();
  });

var initlat = sessionStorage.getItem('initlat');
var initlon = sessionStorage.getItem('initlon');



var userPosition =
        {
        lat: 53.159830,
        lon: -6.909000,
        mylat: 53.159830,
        mylon: -6.909000
        };



function laError() {
                if(1 === 1) {

                    $('#nahome').hide();
                    $('#snooper').hide();
                if (!initlat) {
                var lat = userPosition.mylat
                var lon = userPosition.mylon
                } else {
                    var lat = sessionStorage.getItem('initlat')
                    var lon = sessionStorage.getItem('initlon')
                }

                    document.getElementById('q').value = lat
                    document.getElementById('area').value = lon
                    var mymap = L.map('mapid').setView([lat, lon], 12);
                    var marker = L.marker([lat, lon],{'draggable':true}).addTo(mymap);

                    var circle = L.circle([lat, lon], 5000,{'color':'green'}).addTo(mymap);
                  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw'
}).addTo(mymap);
var iOSSafari = /iP(ad|od|hone)/i.test(window.navigator.userAgent) && /WebKit/i.test(window.navigator.userAgent) && !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(window.navigator.userAgent));

var shown = sessionStorage.getItem('shown') || 'no';
var seen = sessionStorage.getItem('seen') || 'no';
var found = sessionStorage.getItem('found') || 'no';
var alerted = sessionStorage.getItem('alerted') || 'no';

var firstTime = sessionStorage.getItem('firstTime') || 'no';


var mlo = $('#rush').text()
var mlo2 = $('#rush2').text()


if (alerted != 'yes' && shown != 'yes') {
    Swal.fire('Oops...', 'Due to security restrictions by your browser, your exact location cannot be identified. Please enter you current location in the box below and click the button, or drag the pin and click the button.', 'error')
        $('#resetme').hide();

        //alert("");
         $('#iphone').show();
        $('#king').hide();
        $('#search').text('Set as your Location')

        sessionStorage.setItem('shown','yes');
        sessionStorage.setItem('alerted','yes');
        sessionStorage.setItem('firstTime','yes');


} else {
 lat = parseFloat($('#hello').text())
lon = parseFloat($('#hello2').text())
if (mlo == '' && seen != 'yes' && lat == 53.15983 && lon == -6.90900 || Number.isNaN(lat)) {
    $('#tom').hide();
   if (mlo == '' && seen != 'yes' && lat == 53.15983  && lon == -6.90900 || Number.isNaN(lat)) {
    Swal.fire('Oops...', 'Location not found! Please check spelling and try again.', 'error');
    $('#iphone').show();
    $('#king').hide();
    $('#tom').hide();
    $('#resetme').hide();



    $('#search').text('Set as your Location')
}

} else {
    if (found != 'yes') {
    Swal.fire('Success!', 'Location found! Please move the pin if it is inaccurate', 'success');
    sessionStorage.setItem('found','yes')
    $('#search').show()
    $('#iphone').hide()
    $('#search').text('Calculate')
    $('#nahome').hide();
    $('#snooper').hide();
    document.querySelector('#search').setAttribute('margin-left','0vw')
    document.querySelector('#search').setAttribute('margin-right','8vw!important')

    $('#resetme').show()
    $('#tom').show();

    sessionStorage.setItem('seen','yes');
    sessionStorage.setItem('initlat',mlo)
    sessionStorage.setItem('initlon',mlo2)

}
}
}



var onDrag = function (e) {
    var latlng = marker.getLatLng();
    document.getElementById('latlng1').value = latlng.lat;
    document.getElementById('latlng2').value = latlng.lng;

    marker.setLatLng(new L.LatLng(latlng.lat, latlng.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(latlng.lat, latlng.lng))
    circle.setLatLng(marker.getLatLng())
};


marker.on('drag', onDrag);



document.getElementById('latlng1').value = marker.getLatLng().lat;
document.getElementById('latlng2').value = marker.getLatLng().lng;

function onC(e) {
marker.on('drag touchmove',function(event) {
    var marker = event.target;
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
    circle.setLatLng(marker.getLatLng())

    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;

})
mymap.addLayer(marker);
}
mymap.on('mouseover touchmove', onC);

marker.on('drag touchmove',function(event) {
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
                    circle.setLatLng(marker.getLatLng())

        });



    if($('#one').text() == '') {
        if ($('#search').text() == 'Calculate') {
            $('#resetme').show();
        }

        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        document.getElementById('latlng1').value = mylat
        document.getElementById('latlng2').value = mylon



    if(document.getElementById('hello').innerHTML === '') {
        var mylat = lat
        var mylon = lon
        document.getElementById('latlng1').value = lat
        document.getElementById('latlng2').value = lon



    } else {

        console.log(document.getElementById('hello').innerHTML)
        var mylat = parseFloat(document.getElementById('hello').innerHTML)
        var mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
        circle.setLatLng(marker.getLatLng())

    }


} else {
    var mylat = parseFloat(document.getElementById('hello').innerHTML)
    var mylon = parseFloat(document.getElementById('hello2').innerHTML)
    marker.setLatLng([mylat,mylon]);
    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;
    if(document.getElementById('hello').innerHTML === '') {
        var v;
    } else {
        marker.on('drag',function(event) {
                    circle.setLatLng(marker.getLatLng())

        });
        console.log(document.getElementById('hello').innerHTML)
        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
        circle.setLatLng(marker.getLatLng())

        console.log(marker.getLatLng().lng)
    }


var marker2 = L.marker([{{a}}, {{b}}]).addTo(mymap);
function createMarker(){
     var markerFrom = marker
     var markerTo =  marker2
     var from = markerFrom.getLatLng();
     var to = markerTo.getLatLng();
     markerFrom.bindPopup('From ' + (from).toString());
     markerTo.bindPopup('To ' + (to).toString());
     mymap.addLayer(markerTo);
     mymap.addLayer(markerFrom);
     getDistance(from, to);
}

createMarker()
    var polygon = L.polygon([
    [marker.getLatLng().lat, marker.getLatLng().lng],
    [{{a}}, {{b}}],
    [{{a}}, {{b}}]
]).addTo(mymap);

function getDistance(from, to)
{

    var uno = document.getElementById('one');
    var c2 = 5-from.distanceTo(to).toFixed(0)/1000
    console.log(c2)
    if(c2 < 0) {
        uno.innerHTML = 'STATUS: DANGER'
        uno.style.color = 'red'

        document.querySelector('.leaflet-interactive').setAttribute('fill','red')
            document.querySelector('.leaflet-interactive').setAttribute('stroke','red')
        document.querySelector('#resetme').style.top = '55vw'
        var container2 = document.getElementById('three');

        document.getElementById('tom').setAttribute('class','alert alert-danger')
        var c5 = from.distanceTo(to).toFixed(0)/1000 - 5
        var c51 = Math.round((c5 + Number.EPSILON) * 100) / 100
        container2.innerHTML = "Distance outside safe zone  : " + c51 + 'km'
    } else {
        uno.innerHTML = 'STATUS: SAFE'
        uno.style.color = 'green'
            document.querySelector('#resetme').style.top = '55vw'

        document.getElementById('tom').setAttribute('class','alert alert-success')
        var container2 = document.getElementById('three');
        var c52 = Math.round((c2 + Number.EPSILON) * 100) / 100
    container2.innerHTML = "Distance left in safe zone  : " + c52 + 'km'
    }

    var container = document.getElementById('two');
    container.innerHTML = ("Your Location to Destination  : " + (from.distanceTo(to)).toFixed(0)/1000) + 'km';

}




}





            }
}



        if(navigator.geolocation) {

var iOSSafari = /iP(ad|od|hone)/i.test(window.navigator.userAgent) && /WebKit/i.test(window.navigator.userAgent) && !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(window.navigator.userAgent));
            // if( /Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent) ) {

            if(x.innerHTML == 'User denied the request for Geolocation.' || x.innerHTML == 'Location information is unavailable.' || x.innerHTML == "The request to get user location timed out." || x.innerHTML == "An unknown error occurred." || iOSSafari || sessionStorage.getItem('atHome') == 'yes') {
                    $('#nahome').hide();
                    $('#snooper').hide();

                if (!initlat) {
                var lat = userPosition.mylat
                var lon = userPosition.mylon
                } else {
                    var lat = sessionStorage.getItem('initlat')
                    var lon = sessionStorage.getItem('initlon')
                }

                    document.getElementById('q').value = lat
                    document.getElementById('area').value = lon
                    var mymap = L.map('mapid').setView([lat, lon], 12);
                    var marker = L.marker([lat, lon],{'draggable':true}).addTo(mymap);
                    var off = sessionStorage.getItem('off') || 'yes';
                    if(sessionStorage.getItem('atHome') == 'yes') {
                        navigator.geolocation.getCurrentPosition(function (position){
                    var manmark;
                    //alert(manmark)
                    function makeTracker() {
                        if (sessionStorage.getItem('off') != 'no') {
                        manmark = L.marker([lat, lon]).addTo(mymap);
                        sessionStorage.setItem('off','no')
                        //alert(manmark)

                        } else {
                            //alert('ye')
                            sessionStorage.setItem('off','yes')

                        }

                    }

  function onLocationFound(e) {
      if (sessionStorage.getItem('off') == 'no') {
          //alert('supposed to work')
    var radius = e.accuracy / 2;
    if (manmark != undefined) {
            var d = mymap.distance(e.latlng, circle.getLatLng());
    var isInside = d < circle.getRadius();
    if (isInside) {
        clearTimeout();
    } else {
        setTimeout(function(){ Swal.fire('Danger!', 'You are outside the 2km safety zone! Please return', 'error'); window.navigator.vibrate(200); }, 2000);
    }

        } else {
            Swal.fire('Success!', 'Tracker initiated! Please make sure you are at home or your home location is set. if not, please move the pin to home location and reset tracker', 'success')
            $('#snooper').attr('class','btn btn-danger')
            $('#snooper').text('Stop Tracker')
            manmark = L.marker([position.coords.latitude, position.coords.longitude]).addTo(mymap);
             //
        }

    manmark.setLatLng(e.latlng);
    manMark();
    var d = mymap.distance(e.latlng, circle.getLatLng());
    var isInside = d < circle.getRadius();
    if (isInside) {
        clearTimeout();
    } else {
        setTimeout(function(){ Swal.fire('Danger!', 'You are outside the 2km safety zone! Please return', 'error') }, 2000);
    }

      }
}



mymap.on('locationfound', onLocationFound);
mymap.locate({setView: false, watch: true, maxZoom: 18});


$('#snooper').on('click',makeTracker)

                        });

}

                    var circle = L.circle([lat, lon], 5000,{'color':'green'}).addTo(mymap);
                  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw'
}).addTo(mymap);



document.getElementById('nahome').addEventListener('click',la2)

var iOSSafari = /iP(ad|od|hone)/i.test(window.navigator.userAgent) && /WebKit/i.test(window.navigator.userAgent) && !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(window.navigator.userAgent));

var shown = sessionStorage.getItem('shown') || 'no';
var seen = sessionStorage.getItem('seen') || 'no';
var found = sessionStorage.getItem('found') || 'no';
var alerted = sessionStorage.getItem('alerted') || 'no';

var firstTime = sessionStorage.getItem('firstTime') || 'no';


var mlo = $('#rush').text()
var mlo2 = $('#rush2').text()

var justOne = sessionStorage.getItem('justOne') || 'no';

if (alerted != 'yes' && shown != 'yes') {

        if (sessionStorage.getItem('atHome') == 'yes') {
               //$('#snooper').show();
               if (justOne == 'no') {
        Swal.fire('Not at Home?', 'Not at home? not a problem. Track your location remotely. Simply enter your home address in the box below and begin tracking from there', 'success')
        sessionStorage.setItem('justOne','yes')
               }
        $('#nahome').hide();
         $('#resetme').hide();
    } else {
    Swal.fire('Oops...', 'Due to security restrictions by your browser, your exact location cannot be identified. Please enter you current location in the box below and click the button, or drag the pin and click the button.', 'error')
        $('#resetme').hide();
}
        //alert("");
         $('#iphone').show();
        $('#king').hide();

    if (sessionStorage.getItem('atHome') == 'yes') {
        $('#search').text('Set as home Location')

    } else {
        $('#search').text('Set as your Location')

    }

        sessionStorage.setItem('shown','yes');
        sessionStorage.setItem('alerted','yes');
        sessionStorage.setItem('firstTime','yes');


} else {
 lat = parseFloat($('#hello').text())
lon = parseFloat($('#hello2').text())
if (mlo == '' && seen != 'yes' && lat == 53.15983 && lon == -6.90900 || Number.isNaN(lat)) {
    $('#tom').hide();
   if (mlo == '' && seen != 'yes' && lat == 53.15983  && lon == -6.90900 || Number.isNaN(lat)) {
    Swal.fire('Oops...', 'Location not found! Please check spelling and try again.', 'error');
    $('#iphone').show();
    $('#king').hide();
    $('#tom').hide();
    $('#resetme').hide();


    if (sessionStorage.getItem('atHome') == 'yes') {
        $('#search').text('Set as home Location')

    } else {
        $('#search').text('Set as your Location')

    }

}

} else {
    if (found != 'yes') {
    Swal.fire('Success!', 'Location found! Please move the pin if it is inaccurate', 'success');
    sessionStorage.setItem('found','yes')
    $('#search').show()
    $('#iphone').hide()
    $('#search').text('Calculate')
    if (sessionStorage.getItem('atHome') == 'yes') {
             $('#nahome').hide();
             $('#snooper').show();
        } else {
             $('#resetme').show();

              document.querySelector('#search').setAttribute('margin-left','0vw')
            document.querySelector('#search').setAttribute('margin-right','8vw!important')
        }


    $('#tom').show();

    sessionStorage.setItem('seen','yes');
    sessionStorage.setItem('initlat',mlo)
    sessionStorage.setItem('initlon',mlo2)

}
}
}



var onDrag = function (e) {
    var latlng = marker.getLatLng();
    document.getElementById('latlng1').value = latlng.lat;
    document.getElementById('latlng2').value = latlng.lng;

    marker.setLatLng(new L.LatLng(latlng.lat, latlng.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(latlng.lat, latlng.lng))
    circle.setLatLng(marker.getLatLng())
};


marker.on('drag', onDrag);



document.getElementById('latlng1').value = marker.getLatLng().lat;
document.getElementById('latlng2').value = marker.getLatLng().lng;

function onC(e) {
marker.on('drag touchmove',function(event) {
    var marker = event.target;
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
    circle.setLatLng(marker.getLatLng())

    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;

})
mymap.addLayer(marker);
}
mymap.on('mouseover touchmove', onC);

marker.on('drag touchmove',function(event) {
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
                    circle.setLatLng(marker.getLatLng())

        });



    if($('#one').text() == '') {
        if ($('#search').text() == 'Calculate') {
            if (sessionStorage.getItem('atHome') == 'yes') {
                $('#resetme').hide();
                $('#snooper').show();



    } else {
        $('#resetme').show();

    }

        }

        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        document.getElementById('latlng1').value = mylat
        document.getElementById('latlng2').value = mylon



    if(document.getElementById('hello').innerHTML === '') {
        var mylat = lat
        var mylon = lon
        document.getElementById('latlng1').value = lat
        document.getElementById('latlng2').value = lon



    } else {

        console.log(document.getElementById('hello').innerHTML)
        var mylat = parseFloat(document.getElementById('hello').innerHTML)
        var mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
        circle.setLatLng(marker.getLatLng())

    }


} else {
    if (sessionStorage.getItem('atHome') == 'yes') {
        $('#snooper').show()

    } else {
    $('#resetme').show();

    }
    var mylat = parseFloat(document.getElementById('hello').innerHTML)
    var mylon = parseFloat(document.getElementById('hello2').innerHTML)
    marker.setLatLng([mylat,mylon]);
    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;
    if(document.getElementById('hello').innerHTML === '') {
        var v;
    } else {
        marker.on('drag',function(event) {
                    circle.setLatLng(marker.getLatLng())

        });
        console.log(document.getElementById('hello').innerHTML)
        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
        circle.setLatLng(marker.getLatLng())

        console.log(marker.getLatLng().lng)
    }


var marker2 = L.marker([{{a}}, {{b}}]).addTo(mymap);

function createMarker(){
     var markerFrom = marker
     var markerTo =  marker2
     var from = markerFrom.getLatLng();
     var to = markerTo.getLatLng();
     markerFrom.bindPopup('From ' + (from).toString());
     markerTo.bindPopup('To ' + (to).toString());
     mymap.addLayer(markerTo);
     mymap.addLayer(markerFrom);
     getDistance(from, to);
}

createMarker()
    var polygon = L.polygon([
    [marker.getLatLng().lat, marker.getLatLng().lng],
    [{{a}}, {{b}}],
    [{{a}}, {{b}}]
]).addTo(mymap);

function getDistance(from, to)
{

    var uno = document.getElementById('one');
    var c2 = 2-from.distanceTo(to).toFixed(0)/1000
    if(c2 < 0) {
        uno.innerHTML = 'STATUS: DANGER'
        uno.style.color = 'red'

        document.querySelector('.leaflet-interactive').setAttribute('fill','red')
            document.querySelector('.leaflet-interactive').setAttribute('stroke','red')
        document.querySelector('#resetme').style.top = '55vw'
        var container2 = document.getElementById('three');

        document.getElementById('tom').setAttribute('class','alert alert-danger')
        var c5 = from.distanceTo(to).toFixed(0)/1000 - 5
        var c51 = Math.round((c5 + Number.EPSILON) * 100) / 100
        container2.innerHTML = "Distance outside safe zone  : " + c51 + 'km'
    } else {
        uno.innerHTML = 'STATUS: SAFE'
        uno.style.color = 'green'
            document.querySelector('#resetme').style.top = '55vw'

        document.getElementById('tom').setAttribute('class','alert alert-success')
        var container2 = document.getElementById('three');
        var c52 = Math.round((c2 + Number.EPSILON) * 100) / 100
    container2.innerHTML = "Distance left in safe zone  : " + c52 + 'km'
    }

    var container = document.getElementById('two');
    container.innerHTML = ("Your Location to Destination  : " + (from.distanceTo(to)).toFixed(0)/1000) + 'km';

}




}





            } else {
                snoop = sessionStorage.getItem('snoop') || 'no';


                kloklat = sessionStorage.getItem('onestep') || '';
                kloklon = sessionStorage.getItem('twostep') || '';
                klokpapi = sessionStorage.getItem('fourstep') || '';
                klokmami = sessionStorage.getItem('threestep') || '';
                onem = sessionStorage.getItem('once') || 'no';


                navigator.geolocation.getCurrentPosition(function(position){
                     sessionStorage.getItem('off');
                    if (kloklat != '' && snoop == 'yes') {

                        lat = sessionStorage.getItem('onestep')
                        lon = sessionStorage.getItem('twostep')

                    } else {
                    lat = position.coords.latitude;
                    lon = position.coords.longitude;
                    sessionStorage.setItem('onestep',lat)
                    sessionStorage.setItem('twostep',lon)
                    sessionStorage.setItem('snoop','yes')

}

                    document.getElementById('q').value = lat
                    document.getElementById('latlng1').value = lat
                    document.getElementById('latlng2').value = lon


                    document.getElementById('area').value = lon
                    var mymap = L.map('mapid').setView([lat, lon], 14);
                    var marker = L.marker([lat, lon],{'draggable':true}).addTo(mymap);
                    var manmark;
                    //alert(manmark)
                    //alert(sessionStorage.getItem('off'))
                    function makeTracker() {
                        if (sessionStorage.getItem('off') != 'no') {
                        manmark = L.marker([lat, lon]).addTo(mymap);
                        sessionStorage.setItem('off','no')
                        //alert(manmark)

                        } else {
                            //alert('ye')
                            sessionStorage.setItem('off','yes')

                        }

                    }

  function onLocationFound(e) {
      if (sessionStorage.getItem('off') == 'no') {
          //alert('supposed to work')
    var radius = e.accuracy / 2;
    if (manmark != undefined) {
            var d = mymap.distance(e.latlng, circle.getLatLng());
    var isInside = d < circle.getRadius();
    if (isInside) {
        clearTimeout();
    } else {
        setTimeout(function(){ Swal.fire('Danger!', 'You are outside the 2km safety zone! Please return', 'error') }, 2000);
    }

        } else {
            Swal.fire('Success!', 'Tracker initiated! Please make sure you are at home or your home location is set. if not, please move the pin to home location and reset tracker', 'success')
            $('#snooper').attr('class','btn btn-danger')
            $('#snooper').text('Stop Tracker')
            manmark = L.marker([position.coords.latitude, position.coords.longitude]).addTo(mymap);
             //
        }

    manmark.setLatLng(e.latlng);
    //manMark();
    var d = mymap.distance(e.latlng, circle.getLatLng());
    var isInside = d < circle.getRadius();
    if (isInside) {
        clearTimeout();
    } else {
        setTimeout(function(){ Swal.fire('Danger!', 'You are outside the 2km safety zone! Please return', 'error') }, 2000);
    }

      }
}

mymap.on('locationfound', onLocationFound);
mymap.locate({setView: false, watch: true, maxZoom: 18});


$('#snooper').on('click',makeTracker)

var circle = L.circle([lat, lon], 5000,{'color':'green'}).addTo(mymap);
L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoidmFnaWYiLCJhIjoiY2p4a3E0N2I0MmN6dTNvczg0MmgxN2k2diJ9.Ub6lAjqqqb3ZTi1-lJKHHw'
}).addTo(mymap);



var onDrag = function (e) {
    var latlng = marker.getLatLng();
    document.getElementById('latlng1').value = latlng.lat;
    document.getElementById('latlng2').value = latlng.lng;

    marker.setLatLng(new L.LatLng(latlng.lat, latlng.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(latlng.lat, latlng.lng))
    circle.setLatLng(marker.getLatLng())
    sessionStorage.setItem('onestep',latlng.lat)
    sessionStorage.setItem('twostep',latlng.lng)
};


marker.on('drag', onDrag);



document.getElementById('latlng1').value = marker.getLatLng().lat;
document.getElementById('latlng2').value = marker.getLatLng().lng;

function onC(e) {
marker.on('drag touchmove',function(event) {
    var marker = event.target;
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
    circle.setLatLng(marker.getLatLng())
    sessionStorage.setItem('onestep',position.lat)
    sessionStorage.setItem('twostep',position.lng)

    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;

})
mymap.addLayer(marker);
}
mymap.on('mouseover touchmove', onC);

marker.on('drag touchmove',function(event) {
    var position = marker.getLatLng();
    marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
    mymap.panTo(new L.LatLng(position.lat, position.lng))
                    circle.setLatLng(marker.getLatLng())
    sessionStorage.setItem('onestep',position.lat)
    sessionStorage.setItem('twostep',position.lng)

        });



    if($('#one').text() == '') {

        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        document.getElementById('latlng1').value = mylat
        document.getElementById('latlng2').value = mylon
        sessionStorage.setItem('threestep',mylat)
        sessionStorage.setItem('fourstep',mylon)

    if(document.getElementById('hello').innerHTML === '') {
        var v;
        var mylat = lat
        var mylon = lon
        document.getElementById('latlng1').value = lat
        document.getElementById('latlng2').value = lon
        sessionStorage.setItem('onestep',lat)
        sessionStorage.setItem('twostep',lon)



    } else {

        console.log(document.getElementById('hello').innerHTML)
        var mylat = parseFloat(document.getElementById('hello').innerHTML)
        var mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
         sessionStorage.setItem('threestep',mylat)
        sessionStorage.setItem('fourstep',mylon)
        circle.setLatLng(marker.getLatLng())

    }


} else {
    var mylat = parseFloat(document.getElementById('hello').innerHTML)
    var mylon = parseFloat(document.getElementById('hello2').innerHTML)
    marker.setLatLng([mylat,mylon]);
     sessionStorage.setItem('threestep',mylat)
    sessionStorage.setItem('fourstep',mylon)
    document.getElementById('latlng1').value = marker.getLatLng().lat;
    document.getElementById('latlng2').value = marker.getLatLng().lng;
    if(document.getElementById('hello').innerHTML === '') {
        var v;
    } else {
        marker.on('drag',function(event) {
                    circle.setLatLng(marker.getLatLng())

        });
        console.log(document.getElementById('hello').innerHTML)
        mylat = parseFloat(document.getElementById('hello').innerHTML)
        mylon = parseFloat(document.getElementById('hello2').innerHTML)
        marker.setLatLng([mylat,mylon]);
        mymap.panTo([mylat,mylon]);
         sessionStorage.setItem('threestep',mylat)
        sessionStorage.setItem('fourstep',mylon)
        circle.setLatLng(marker.getLatLng())

        console.log(marker.getLatLng().lng)
    }


var marker2 = L.marker([{{a}}, {{b}}]).addTo(mymap);

function createMarker(){
     var markerFrom = marker
     var markerTo =  marker2
     var from = markerFrom.getLatLng();
     var to = markerTo.getLatLng();
     markerFrom.bindPopup('From ' + (from).toString());
     markerTo.bindPopup('To ' + (to).toString());
     mymap.addLayer(markerTo);
     mymap.addLayer(markerFrom);
     getDistance(from, to);
}

createMarker()
    var polygon = L.polygon([
    [marker.getLatLng().lat, marker.getLatLng().lng],
    [{{a}}, {{b}}],
    [{{a}}, {{b}}]
]).addTo(mymap);

function getDistance(from, to)
{

    var uno = document.getElementById('one');
    var c2 = 5-from.distanceTo(to).toFixed(0)/1000
    if(c2 < 0) {
        uno.innerHTML = 'STATUS: DANGER'
        uno.style.color = 'red'
        document.querySelector('.leaflet-interactive').setAttribute('fill','red')
            document.querySelector('.leaflet-interactive').setAttribute('stroke','red')
        document.getElementById('tom').setAttribute('class','alert alert-danger')
                document.querySelector('#resetme').style.top = '55vw'

        var container2 = document.getElementById('three');
        var c5 = from.distanceTo(to).toFixed(0)/1000 - 5
        var c51 = Math.round((c5 + Number.EPSILON) * 100) / 100
        container2.innerHTML = "Distance outside safe zone  : " + c51 + 'km'
    } else {
        uno.innerHTML = 'STATUS: SAFE'
        uno.style.color = 'green'
                document.querySelector('#resetme').style.top = '55vw'

        document.getElementById('tom').setAttribute('class','alert alert-success')

        var container2 = document.getElementById('three');
        var c52 = Math.round((c2 + Number.EPSILON) * 100) / 100
    container2.innerHTML = "Distance left in safe zone  : " + c52 + 'km'
    }

    var container = document.getElementById('two');
    container.innerHTML = ("Your Location to Destination  : " + (from.distanceTo(to)).toFixed(0)/1000) + 'km';

}




}

                },laError)


}
            }

    });
</script>



<style>

</style>

</body>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<footer>
<div id="allrise" class="alert alert-info" role="alert" style='background-image: linear-gradient(to bottom,#5bc0de 0,#2aabd2 100%); color: white; text-align: center; width: 100vw; bottom: 0; margin-bottom: -15vw;'>
<i style="font-size: 1.5em;">Made by <a target="_blank" style="color: white;" href="https://www.linkedin.com/in/vagif-aliyev-88a253190/">Vagif Aliyev</a></i>
</div>
</footer>

</html>













